# Contador de pasos Version 3

Mejoras:
- Envio por el modulo Wifi, utilizando el metodo UART to Wifi Passtrougth, lo que permite poder enviar a travez del modulo Wifi como si se trata de un puerto serial.
- En este caso se envia un GET cada 1 seg, con informaci√≥n de 5 variables.

## Implementacion con Node-Red
Codigo de ejemplo utilizando Node-Red como un Gateway, el cual recibe el GET Request del Arduino y hace lo siguiente:

- Separa los datos y permite visualizarlos en un dashboard.
- Reenvia a otra pagina por medio de un HTTP GET

- Reenvia a otra pagina por medio de un HTTP POST

- Reenvia los datos a un formulario Google, el cual a su vez alimenta una tabla de Google Sheets 
	
Para mas detalle ver los siguientes tutoriales:
	
	https://groups.google.com/forum/#!topic/node-red/IO3I0PI_u2g

	https://groups.google.com/forum/#!topic/node-red/ThwhcHKqe-M


- Reenvia los datos a la plataforma ThingSpeaks.
- Agrega los datos a un archivo separado por comas CSV.

Pendiente por hacer:
- Alimentar una base de datos como MySQL con los datos recibidos:


[{"id":"163cb793.5b2438","type":"tab","label":"HTTP Gateway","disabled":false,"info":"objetivo: recibir un GET request desde el Arduino\ny reenviarlo a los siguientes destinos:\n- enviarlo a otra pagina por GET\n- enviarlo a otra pagina por POST\n- visualizarlo en un dahboard\n- enviarlo a Thingspeaks o carriots\n- alimentar una hoja de Google Sheets.\n- crear un archivo CSV\n- alimentar una base de datos mySQL"},{"id":"b84dbd11.959ab","type":"function","z":"163cb793.5b2438","name":"POST data (recibe PHP)","func":"var newmsg = { \n     payload:msg.payload,\n     headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }; \nreturn newmsg; ","outputs":1,"noerr":0,"x":421.0000801086426,"y":279.99950981140137,"wires":[["175442b2.9452ed"]]},{"id":"175442b2.9452ed","type":"http request","z":"163cb793.5b2438","name":"POST","method":"POST","ret":"txt","url":"http://iotstuff.000webhostapp.com/colector_datos_json.php","tls":"","x":703.0002021789551,"y":277.9999179840088,"wires":[[]]},{"id":"89476498.bd23e8","type":"http in","z":"163cb793.5b2438","name":"","url":"/iotgateway","method":"get","upload":false,"swaggerDoc":"","x":169.33334350585938,"y":252.0000762939453,"wires":[["d3e7aa98.895588","b84dbd11.959ab","13703074.04121","e80159a2.6e42a8","d9d17cb5.f286d","c5096596.8efc18","5295bc7e.333b44","ce80a5f6.268978"]]},{"id":"d3e7aa98.895588","type":"function","z":"163cb793.5b2438","name":"Separar campos","func":"var controlActividad =  {payload : msg.payload.controlActividad};\nvar cuentaPasos      =  {payload : msg.payload.cuentaPasos};\nvar cuentaFlote      =  {payload : msg.payload.cuentaFlote};\nvar freqPasos        =  {payload : msg.payload.freqPasos};\nvar freqFlote        =  {payload : msg.payload.freqFlote};\n\nreturn [controlActividad,cuentaPasos,cuentaFlote,freqPasos,freqFlote];\n","outputs":"5","noerr":0,"x":401.0001220703125,"y":198.0003662109375,"wires":[["a0d18653.731298"],["c6a23486.60db38"],["52c036cb.9ffcf8"],["3588b9e6.4a9d36"],["59b0950f.b0bcdc"]]},{"id":"a0d18653.731298","type":"ui_text","z":"163cb793.5b2438","group":"a653ab67.348638","order":1,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-left","x":767.0000686645508,"y":46.333322286605835,"wires":[]},{"id":"c6a23486.60db38","type":"ui_gauge","z":"163cb793.5b2438","name":"","group":"fa5aef2a.f2ae7","order":2,"width":0,"height":0,"gtype":"gage","title":"Gauge","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":738,"y":91.33328056335449,"wires":[]},{"id":"52c036cb.9ffcf8","type":"ui_gauge","z":"163cb793.5b2438","name":"","group":"32d15d6c.c28e52","order":2,"width":0,"height":0,"gtype":"gage","title":"Gauge","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":738,"y":128.33328247070312,"wires":[]},{"id":"3588b9e6.4a9d36","type":"ui_gauge","z":"163cb793.5b2438","name":"","group":"32d15d6c.c28e52","order":1,"width":0,"height":0,"gtype":"gage","title":"Gauge","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":737.0000839233398,"y":166.3332862854004,"wires":[]},{"id":"59b0950f.b0bcdc","type":"ui_gauge","z":"163cb793.5b2438","name":"","group":"fa5aef2a.f2ae7","order":1,"width":0,"height":0,"gtype":"gage","title":"Gauge","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":738.0000038146973,"y":206.33337020874023,"wires":[]},{"id":"a40f0653.1ef878","type":"comment","z":"163cb793.5b2438","name":"Datos de Google Forms","info":"FormID:\n1KCHWjT8Sbylrd4H634N0F8RuDHjGdRLhpIbizdvkgFw\n\ncampos:\ncontrolActividad:entry.1591686251\ncuentaPasos: entry.1272101942\ncuentaFlote: entry.1457143966\nfreqPasos: entry.1263150458\nfreqFlote: entry.1651804651","x":400.00001525878906,"y":364.6666736602783,"wires":[]},{"id":"13703074.04121","type":"function","z":"163cb793.5b2438","name":"data to GForms/GSheets","func":"msg.url =\"https://docs.google.com/forms/d/\";\nmsg.url+=\"1KCHWjT8Sbylrd4H634N0F8RuDHjGdRLhpIbizdvkgFw\";\nmsg.url+=\"/formResponse?\";\nmsg.url+=\"entry.1591686251=\"+msg.payload.controlActividad;\nmsg.url+=\"&entry.1272101942=\"+msg.payload.cuentaPasos;\nmsg.url+=\"&entry.1457143966=\"+msg.payload.cuentaFlote;\nmsg.url+=\"&entry.1263150458=\"+msg.payload.freqPasos;\nmsg.url+=\"&entry.1651804651=\"+msg.payload.freqFlote;\nreturn msg;","outputs":1,"noerr":0,"x":409.33335876464844,"y":404.3333387374878,"wires":[["5941cb88.550644"]]},{"id":"5941cb88.550644","type":"http request","z":"163cb793.5b2438","name":"","method":"GET","url":"","tls":"","x":686.3334503173828,"y":402.3334197998047,"wires":[[]]},{"id":"e80159a2.6e42a8","type":"debug","z":"163cb793.5b2438","name":"","active":true,"console":"false","complete":"false","x":270.3333339691162,"y":61.66667175292969,"wires":[]},{"id":"c5096596.8efc18","type":"function","z":"163cb793.5b2438","name":"GET data (recibe PHP)","func":"msg.url=\"http://iotstuff.000webhostapp.com/colector_datos_json.php?\";\nmsg.url+=\"via=GET\";\nmsg.url+=\"&controlActividad=\"+msg.payload.controlActividad;\nmsg.url+=\"&cuentaPasos=\"+msg.payload.cuentaPasos;\nmsg.url+=\"&cuentaFlote=\"+msg.payload.cuentaFlote;\nmsg.url+=\"&freqPasos=\"+msg.payload.freqPasos;\nmsg.url+=\"&freqFlote=\"+msg.payload.freqFlote;\nreturn msg;","outputs":1,"noerr":0,"x":418,"y":326,"wires":[["aabd995e.078b48"]]},{"id":"d9d17cb5.f286d","type":"template","z":"163cb793.5b2438","name":"page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n    <head></head>\n    <body>\n        <h1>Datos recibidos!</h1>\n    </body>\n</html>","x":361.00006675720215,"y":126.66677665710449,"wires":[["addfa3f4.fbb27"]]},{"id":"addfa3f4.fbb27","type":"http response","z":"163cb793.5b2438","name":"","statusCode":"","headers":{},"x":512.0000343322754,"y":105.6666955947876,"wires":[]},{"id":"aabd995e.078b48","type":"http request","z":"163cb793.5b2438","name":"GET","method":"GET","ret":"txt","url":"","tls":"","x":690,"y":328,"wires":[[]]},{"id":"ce226126.e35de","type":"file","z":"163cb793.5b2438","name":"","filename":"C:\\Users\\clram\\Desktop\\noderedfile.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":462.0001411437988,"y":564.3333435058594,"wires":[]},{"id":"5295bc7e.333b44","type":"csv","z":"163cb793.5b2438","name":"","sep":",","hdrin":"","hdrout":"","multi":"one","ret":"\\n","temp":"controlActividad,cuentaPasos,cuentaFlote,freqPasos,freqFlote","x":191,"y":512.0000610351562,"wires":[["ce226126.e35de"]]},{"id":"ce80a5f6.268978","type":"function","z":"163cb793.5b2438","name":"data to Thingspeaks","func":"msg.url=\"https://api.thingspeak.com/update?api_key=I5KSH8735L2KBN0P\"\nmsg.url+=\"&field1=\"+msg.payload.controlActividad;\nmsg.url+=\"&field2=\"+msg.payload.cuentaPasos;\nmsg.url+=\"&field3=\"+msg.payload.cuentaFlote;\nmsg.url+=\"&field4=\"+msg.payload.freqPasos;\nmsg.url+=\"&field5=\"+msg.payload.freqFlote;\nreturn msg;","outputs":1,"noerr":0,"x":400.0000228881836,"y":466.3333387374878,"wires":[["a3e0e19.06e4f2"]]},{"id":"a3e0e19.06e4f2","type":"http request","z":"163cb793.5b2438","name":"","method":"GET","url":"","tls":"","x":687.0000381469727,"y":468.0000877380371,"wires":[[]]},{"id":"a653ab67.348638","type":"ui_group","name":"Group 3","tab":"b57b80c8.e3527","order":1,"disp":true,"width":6},{"id":"fa5aef2a.f2ae7","type":"ui_group","name":"Group 2","tab":"b57b80c8.e3527","order":3,"disp":true,"width":6},{"id":"32d15d6c.c28e52","type":"ui_group","z":"","name":"Default","tab":"b57b80c8.e3527","order":2,"disp":true,"width":"6"},{"id":"b57b80c8.e3527","type":"ui_tab","z":"","name":"Home","icon":"dashboard"}]
